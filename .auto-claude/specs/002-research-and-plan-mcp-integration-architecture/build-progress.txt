=== AUTO-BUILD PROGRESS ===

Project: MCP Server Integration with Two-Tier Configuration
Spec: 002-research-and-plan-mcp-integration-architecture
Workspace: Managed by orchestrator
Started: 2025-12-23

Workflow Type: feature
Rationale: New user-facing functionality requiring changes across types, backend services,
           API routes, and frontend UI. Introduces MCP server configuration management
           with per-task isolation.

Session 1 (Planner):
- Created implementation_plan.json
- Phases: 8
- Total subtasks: 12
- Created init.sh

Phase Summary:
1. Type Definitions (phase-1-types): 3 subtasks, no dependencies
   - Add MCP types to settings.ts
   - Add enabledMcpServers to Feature type
   - Type ExecuteOptions.mcpServers properly

2. Backend Settings Service (phase-2-backend-settings): 2 subtasks, depends on phase-1
   - Settings migration for v2 with mcpServers
   - MCP config conversion utility

3. Provider MCP Integration (phase-3-backend-provider): 2 subtasks, depends on phase-2
   - Pass MCP servers to Claude SDK
   - Wire MCP config through auto-mode-service

4. Frontend State Management (phase-4-frontend-store): 1 subtask, depends on phase-1
   - Add MCP state/actions to Zustand store

5. Global MCP Settings UI (phase-5-frontend-settings-ui): 2 subtasks, depends on phase-4
   - Create MCP settings panel component
   - Integrate into settings view

6. Per-Task MCP Selection UI (phase-6-frontend-task-dialog): 2 subtasks, depends on phases 4,5
   - Add MCP checkboxes to add-feature-dialog
   - Update feature creation flow

7. Testing and Verification (phase-7-testing): 2 subtasks, depends on phases 3,6
   - Unit tests for settings migration
   - Unit tests for MCP config conversion

8. Integration Verification (phase-8-integration): 1 subtask, depends on phase-7
   - End-to-end MCP isolation verification

Services Involved:
- types: Shared TypeScript interfaces for MCP configuration
- server: Backend settings management, MCP config storage, agent context injection
- ui: Global MCP settings UI, per-task MCP toggle interface

Parallelism Analysis:
- Max parallel phases: 2
- Recommended workers: 2
- Parallel groups:
  * phase-4-frontend-store can run parallel with backend phases
  * phase-5-frontend-settings-ui and phase-3-backend-provider can run together

Verification Strategy:
- Risk Level: HIGH (security-critical MCP isolation requirement)
- Required Tests: Unit tests + Integration tests
- Security: Log verification to confirm disabled MCP servers not loaded
- Browser: Settings UI and task dialog verification

Key Files to Modify:
- libs/types/src/settings.ts (MCP types, SETTINGS_VERSION 1->2)
- libs/types/src/feature.ts (enabledMcpServers field)
- apps/server/src/providers/types.ts (mcpServers typing)
- apps/server/src/providers/claude-provider.ts (pass MCP to SDK)
- apps/server/src/services/settings-service.ts (migration)
- apps/server/src/services/auto-mode-service.ts (wire MCP config)
- apps/ui/src/store/app-store.ts (MCP state)
- apps/ui/src/components/views/board-view/dialogs/add-feature-dialog.tsx (MCP toggles)

Key Files to Create:
- apps/server/src/lib/mcp-config.ts (conversion utility)
- apps/ui/src/components/settings/mcp-settings-panel.tsx (settings UI)
- apps/server/tests/unit/lib/mcp-config.test.ts (tests)

=== STARTUP COMMAND ===

To continue building this spec, run:

  source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 002 --parallel 2

Or manually start development:

  cd .auto-claude/specs/002-research-and-plan-mcp-integration-architecture
  ./init.sh

=== END SESSION 1 ===
